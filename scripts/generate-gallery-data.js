// generate-gallery-data.js
import fs from "fs";
import path from "path";
import sharp from "sharp";

const galleryDir = path.join(process.cwd(), "public", "gallery-imgs");
const outputFile = path.join(
  process.cwd(),
  "public",
  "data",
  "gallery-data.ts"
);

async function generateGalleryData() {
  const files = fs
    .readdirSync(galleryDir)
    .filter((file) => /\.(jpe?g|png|webp)$/i.test(file));

  const gallery = [];

  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    const fullPath = path.join(galleryDir, file);

    try {
      const metadata = await sharp(fullPath).metadata();

      gallery.push({
        id: i + 1,
        src: `/gallery-imgs/${file}`,
        alt: path.parse(file).name.replace(/[-_]/g, " "),
        width: metadata.width || 800,
        height: metadata.height || 600,
      });
    } catch (err) {
      console.error(`Error reading metadata for ${file}:`, err);
    }
  }

  const tsContent = `// ⚠️ Auto-generated by scripts/generate-gallery-data.js
// Do not edit manually.

export interface GalleryImage {
  id: number;
  src: string;
  alt: string;
  width: number;
  height: number;
}

const galleryData: GalleryImage[] = ${JSON.stringify(gallery, null, 2)};

export default galleryData;
`;

  fs.mkdirSync(path.dirname(outputFile), { recursive: true });
  fs.writeFileSync(outputFile, tsContent, "utf-8");

  console.log(`✅ Generated ${outputFile} with ${gallery.length} images.`);
}

generateGalleryData();
